<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audit Service - Code Analysis Dashboard</title>
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Audit Service</h1>
            <p class="subtitle">Code Analysis & Security Audit Dashboard</p>
            <div id="health-status" class="health-status">
                <span class="status-indicator"></span>
                <span class="status-text">Checking...</span>
            </div>
        </header>

        <main>
            <!-- Audit Form -->
            <section class="card">
                <h2>New Audit</h2>
                <form id="audit-form">
                    <div class="form-group">
                        <label for="repository">Repository URL or Path</label>
                        <input
                            type="text"
                            id="repository"
                            name="repository"
                            placeholder="https://github.com/user/repo or /path/to/local/repo"
                            required
                        >
                    </div>

                    <div class="form-group">
                        <label for="branch">Branch (optional)</label>
                        <input
                            type="text"
                            id="branch"
                            name="branch"
                            placeholder="main"
                        >
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="enable-llm" name="enable_llm">
                            Enable LLM Analysis (AI-powered code review)
                        </label>
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="include-tests" name="include_tests">
                            Include Test Files
                        </label>
                    </div>

                    <div class="form-group">
                        <label for="focus">Focus Areas (comma-separated, optional)</label>
                        <input
                            type="text"
                            id="focus"
                            name="focus"
                            placeholder="security, performance, error-handling"
                        >
                    </div>

                    <button type="submit" class="btn btn-primary" id="submit-btn">
                        Start Audit
                    </button>
                </form>
            </section>

            <!-- Loading Indicator -->
            <div id="loading" class="loading hidden">
                <div class="spinner"></div>
                <p>Running audit analysis...</p>
            </div>

            <!-- Results Section -->
            <section id="results-section" class="hidden">
                <!-- Summary Stats -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-files">0</div>
                        <div class="stat-label">Files Scanned</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-issues">0</div>
                        <div class="stat-label">Issues Found</div>
                    </div>
                    <div class="stat-card critical">
                        <div class="stat-value" id="critical-files">0</div>
                        <div class="stat-label">Critical Files</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-tasks">0</div>
                        <div class="stat-label">Tasks Generated</div>
                    </div>
                </div>

                <!-- Audit Details -->
                <div class="card">
                    <div class="card-header">
                        <h2>Audit Report</h2>
                        <div class="audit-id">
                            ID: <code id="audit-id"></code>
                        </div>
                    </div>

                    <!-- Issues by Severity -->
                    <div class="section">
                        <h3>Issues by Severity</h3>
                        <div id="severity-chart" class="severity-chart"></div>
                    </div>

                    <!-- Top Critical Files -->
                    <div class="section">
                        <h3>Top Critical Files</h3>
                        <div id="critical-files-list" class="file-list"></div>
                    </div>

                    <!-- Generated Tasks -->
                    <div class="section">
                        <h3>Generated Tasks</h3>
                        <div id="tasks-list" class="tasks-list"></div>
                    </div>

                    <!-- Tags Found -->
                    <div class="section">
                        <h3>Audit Tags Found</h3>
                        <div id="tags-summary" class="tags-summary"></div>
                    </div>
                </div></h3>

                <!-- Export Options -->
                <div class="actions">
                    <button class="btn btn-secondary" id="download-json">
                        üì• Download JSON Report
                    </button>
                    <button class="btn btn-secondary" id="download-tasks">
                        üìã Download Tasks
                    </button>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="card">
                <h2>Quick Actions</h2>
                <div class="quick-actions">
                    <button class="btn btn-outline" onclick="showTagScanner()">
                        üè∑Ô∏è Tag Scanner
                    </button>
                    <button class="btn btn-outline" onclick="showCloneRepo()">
                        üì¶ Clone Repository
                    </button>
                    <button class="btn btn-outline" onclick="showStaticAnalysis()">
                        üî¨ Static Analysis
                    </button>
                </div>
            </section>

            <!-- Tag Scanner Modal -->
            <div id="tag-scanner-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('tag-scanner-modal')">&times;</span>
                    <h2>Tag Scanner</h2>
                    <form id="tag-scanner-form">
                        <div class="form-group">
                            <label for="tag-path">Directory Path</label>
                            <input type="text" id="tag-path" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Scan Tags</button>
                    </form>
                    <div id="tag-results" class="modal-results hidden"></div>
                </div>
            </div>

            <!-- Clone Repository Modal -->
            <div id="clone-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('clone-modal')">&times;</span>
                    <h2>Clone Repository</h2>
                    <form id="clone-form">
                        <div class="form-group">
                            <label for="clone-url">Repository URL</label>
                            <input type="text" id="clone-url" placeholder="https://github.com/user/repo" required>
                        </div>
                        <div class="form-group">
                            <label for="clone-branch">Branch (optional)</label>
                            <input type="text" id="clone-branch" placeholder="main">
                        </div>
                        <button type="submit" class="btn btn-primary">Clone</button>
                    </form>
                    <div id="clone-results" class="modal-results hidden"></div>
                </div>
            </div>

            <!-- Static Analysis Modal -->
            <div id="static-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('static-modal')">&times;</span>
                    <h2>Static Analysis</h2>
                    <form id="static-form">
                        <div class="form-group">
                            <label for="static-path">Directory Path</label>
                            <input type="text" id="static-path" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Analyze</button>
                    </form>
                    <div id="static-results" class="modal-results hidden"></div>
                </div>
            </div>

            <!-- Error Display -->
            <div id="error-display" class="error-display hidden">
                <span class="close-error" onclick="closeError()">&times;</span>
                <div class="error-content"></div>
            </div>
        </main>

        <footer>
            <p>Audit Service v</p><span id="version">0.1.0</span> |
               <a href="https://github.com/jordanistan/fks" target="_blank">Documentation</a>
            </p>
        </footer>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
